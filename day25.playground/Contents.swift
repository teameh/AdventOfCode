import Foundation

let testInput = """
...>...
.......
......>
v.....>
......>
.......
..vvv..
"""

let testInput2 = """
v...>>.vv>
.vv>>.vv..
>>.>v>...v
>>v>>.>.v.
v>v.vv.v..
>.>>..v...
.vv..>.>v.
v.v..>>v.v
....v..v.>
"""

let input = """
v...>.>vvv.>v.v.>>.v>.>>>>.....>v>....v....v.>>.>.>v.vvv>v...>v>>......v.v>v.>vv.>>v...>...v.v...v.v..>.>..>...>>v.>...>.v.>v.>.....>>...vv
>...v..v.>>.vv.v.>vv...>>v>>>.v.>v.v....v.>...vv>v>v..>>.>.vv...v..>v>.vv>>.v.>v..>>>...vv...v>.>>.>.vv.vvv..>..>.>.>..v>vvv>.>.....>vv..>.
v.>v...>>..>>>..>>...>>>>..vv.......vv.>.v.>..>v>v.v...vvv...v.>>>...v..v.v.>.>.>.v.>...>>.v.>....v.>..v.>.v.>v>>.>...v.>>v>.v.>.v.>...>...
....v>>>.>..>>>.v>.v...v.v>v>.v>.v.v>...v.vv>.>..>.vvvv..>v.>.v.>..vvv.>>.v.vv.vvv..>>.v..v>..>.v.>..v.vv.v>>v>v>.v>v......>>>vv>...>v...>.
..>>v>>>..v.v..>..vv>>v>v......v.v>vvvv.v>....>>>...vv..>vvv.v.>.v.>v>.>.>..>.v..>......>v>>v.>.>.v>v>>v.>.....v>..>..vv>.>vv>.>.>...vv>..>
..>>.>>v..>.>v....v>>...v.v>v.v.>.v.>.vv>>>>>>vv...v..v>>>vv..>...vv..>>v..>>>>...>vv....v.v.v..>..>v.>.>>vvv.vv.>.v>..v.vv.>>vv>.>.v.vv.v.
v>>>.>>.v......v>..v.>...v...>v>.v.>.v.vv..>.>>>v>v>.v>v.v>>..>..>..vv.v.>v...v>.>.>v>.vv.v..>...vv...v>.v>>vvv..v...>>v.>v.....v...>>..v.>
v>>.>vv>vv....v>..>v.v.v>.>.v...>.>>>.v>...>v>>>>v..>>.......vv.v.vv.>v.v>v..v.>..v>v.>v.v.v>v>..v.v>.v...>vv..>.>..>..>....>....>...>.vv..
..>...>...v.>vv>.vvvvv>>......v.v..>>v..>.....v.vv.>v>....>.vvv>.>..>v...>.v.v>v>...v...>..>.>.v>v>v..>.>.>vv.v.>v..>>.>>>>.v.>.v>v......>.
.>.vvv...>.>.......v>v.v..>v.....v.>.v.vv>...>v.>.........v.>v>v.v>.v>...>>v>>>v.>v.>v.vv..>.v..v>v>>.>v.v......>..v.v>v...>>.vv>.>.v.v..vv
..v>>v>....>.v.....v...v>v..>v...vv.>v.>vvv>vv.>v>..>...v.>v>..v.>..>>vv.v..v.v.>..>>...v..>.v.v..v....v>>....v.>v>vv..v.v..>.>.>>..v>>.v..
>.>..>>.>vvv.....>v.v..v>v>v>v.>v..>...........v.v..v>.v>>........>v>...v>..v...vv>.vvv>.v.>v.>..>>.v...v>vvv.>>>.>..>..>....vvv..>>...vvvv
.v......>..>>v.v.v.v>...>>.vv.>>.>.>vvv.vvv...v.vv.>.v....v.v.vv...v..vv...>>v......vv>v>>>v>...>>.>vvv>.>>v.>>>>>>>.>.>>>.v.v>v.v>...v.v.v
.>.>v.>>>>..>>vv.v>..v>v>.>.>>.....>v..>vv>.>v>vvv>....>..>>v.vv..>..>>vv...v>.v.......v>>>v>>.v.....v>..vv..v..vv>.>>>.v.>>>>.v..v>>.>vvv.
..>.v...>.v.>>..>>vvv.v...>v.>.v.>vv.>>>..vv.>...>......v>>vv...v......v.>.>.v....v>v..>...>v>v...vvvv.v>.>.........>.v>..>v>>...>..v.v.v>.
>.v..v.>v>.>>.v>v.vv>...v..>...vv...>.>>v...>.>v.v.vvv>..vvv..>..>vv.v.....v.vv.>v.vvv.vv>>.......>.v>..vv.vv.>>>....v..>....vv.vv.>.v.....
...v..>v.v..>v...v..>.v.vv..>.>...v>v>v.v.....vv>>.v>>vvv>.>>.....v.>vv>.v.......>v...>.....v..>..v.v.>v...>..v>vv.v>>>vv...>....>..>.v.vvv
>v>v.>.vvv....vvv>vv>.v.v>..>v..>....vv.>v>v>.>...>>.v>>.>v.v>.>...>>.>.>.>>....v.vvv..vv.>..>..v.>>>>...v.>.>vv..>.v.>>.>.>.v>v.v..>...>..
>.>vv>vv>>.>v..>....v>.>>v>....>v>>v...vv..v>vv.>..>.v.v>>>.v.v.>>v....vv>v..v.>>vv>v>>.v>...v.>....v.>v>.>...>......>vv.v...>...>v>>...>..
.v.>.>..vv.vv.v..v>>.>.>>>vv.>.>.>>..>..>.vv...>>>vvvv....vv..v..v..v.>v.>v>vv>.v....>vv>v.v.>>.>..v..>>.vvv>.>..>.....v>..v...v.v>>.>.>v.v
vv.v.>.....v.vv...vv>>>...>v..>.v..>v.>v.v.>v...v..vvv.v....vvv.v.>>..>.....v.vv.>..v...>.>>....>.>v>....vv..vv>>.>>>....>>.v.v.v.v>vv...v.
v>>>.>vv.>>.>>v....>>>>.>v>.....>v...>.>.v>.vvv>..v.v.>...v.vv.v>....v.v.vv>v.>v>.>>...>v.v....>>..>.v.>..>vv>v>>vv...v.v.>.v>>vvv>.vv>.>.v
>.vv......>vv..vv.>v.>.v...>...>>v>.>.>.>v....>v>.v....>..>.>>v.v..vv..v>>.....>....v.>.>>>...vvvv.v.......v.v.v..v>.>v..v...>.>..>vvv.>>v.
>.>.v.>vv......vv>v..v...vv..v..>...v....>.>>>.vv>.>>>.>v.v>v.>.vv.>>..v.....>>.>.>v.>.>......vv>>v>>......v..v>v>>.>>.>.>...>>>v>....>.>>>
.>v.>.>>..>>>..>.vv...>v..>>v>v..>>.v.....v....vv>v..v..>...v.v..vv..>>>>>...>......>.v>v>.vv..v.....v..v.v.vvv>.>.>....>.>..>>v>v>>.v.>>v>
.>...>.>v..>>>..v>.>v>v.v...>.>.>v...vv>v.v....>.vv>...v>.v.>vv...v..>>>..>>v>..>vvvv>v.v>.>..v>v>.>v.vv.>.>...v...vvv..v.vv>..v..v.v>.v..v
v>>.>>..>.>....>....v.....v>...>vv.>>..>..>.vv>v..v...v.v.>vv.>...v..vv>....>>...v..v..vv..>>...>.>vv.>.vv>v>...>vv.>vv.v>.v>.vv.v>v.....>.
v.>>.>..>>v...>>v..>>>vvvv>>.>>....>>....v.vvvv.>.....>v>.>v.v..v...v.v...v>>>.>>>..v.v>>.>.>.v..>.....v.>..v.v>...v...>..vv>..>>>v>v>.vvv>
v...>>v...v...vvv.v>.>>.>.v>....>vv.v>....>.>..vv.v.>>.>>.v..>..v..>vv....>>.vv>>..v.>>..v.>.>.>>vv>...v.>.>v>>..v>vv..v>....vvv....vvvvv>>
>..>..>v.v..v..>.>>...v...vv.>v.v.>.>>.>>.>.>.v..>v..>v..v>......v.v.>..>>.v....>..>>.v..>.>>....>...v>.......v..v....>>...>.>>.v>..v..v.>.
..vv..>v.....v>v>...v>...v>v..v.v>v.>.....v..>>>>>vvv>v>>...>>...>vv..>.v>.....>>....>...>.>vvv..>..>.>...vvv>vv>>v>...v..v.>vv..v..>vvv...
>.>v..>..>.vv.vvv>...v.>..>>..v.>>vv>...>>v>......>>>......>..>v.v..>vv>vv..>..>>.v.v..>>>.v>>>>.>>v..>.>..v.>>.>v>...vv>>>v.v.....>.......
..v>v>.>..>>v.v>v.v.>>.v.>..>v...>.v>...v..>.v...>v....v.v>.>>...v.>.>..............>>>..v>...>v..>v.vv>.>.>>>>.>.v>>v.....>v..v...>...v.>.
v...v>>vv....v..>>...v.>>..>>v.v>v.v>>.>..>v..>...v..>..vvvvv...>vv.>.>v......vv.>>>..>.>>.v....v.>>>.v.>>..>.>v..>...>.v.>>.>v..>>....v...
vvv.v>v>.vv>....>..v>..>vv>v.vv.>......vvv.vvvv>>..v>>>v..v>>v..>..>>v>..v....>v...v....v>v>.>.v>....v..v.v>>>.v.v....v>.>.v...>.v..v>.v>>.
v>..>..>.>v.vv.v..v>..>>....v..vvvv>v>..v.v..>>..vv.>.>>v....>>...>v..>.>>v.>.vv.v.v>..>.>.v.v.v>v>..v.v.>>.v.......>..v>.>v....>..v>>v>.>.
>.v..>v.v..>v...v..v>>>v>>>...v.>.>....v..>.>>.>..>..>v>>>..>v.v...v.>..>>>v.v..>>.>.v>v....>>..v.>vvvvv.>>.v>vvv.>>>.vv.v.vvv.v.>v...>.>vv
.v...v.v.>v..vv..v..>v>.vvv.v.>..v>v....v.vv.>vv>vv..>>v.>........vvv>..vv.>v..v...>>>>v..v.v>v>.>..v.>>>.vv..>>>v..vv.vvv>.>.v>..v..v.v>.>
.>..>vv>>.v>..>.vv.>..v>.>>>v>>v..>>....v...>>v>>>.vv.v.>>.>>.v.v..vv.....>..>>...vv.v>>>.v.>..vv..>>...>v......v.v>.vv.>>..>.>...>>>..v>>>
.v..>v>v..v>vv>...vv...vv.....>v>...v.vv>>v>vv>vv>>.>vv...v.v>.....>>......>v..v.v..>.v>v>>.>v....>...>..>...>....v.>v>..v.>>>v>.v..v>..v>.
>vv.v.vvv....v>...v>v......>>..>vv>.v.>.>.v.v......>>>.>..v>v....v.v..v>v>>v>v>...vv..v...>.vv.>>>v>......v.>.>.vv...v..v.>...>>.v.>..v....
>.v.>..>..>>v>>.>..v.>>..>>>>v>.v...v.v.>......v>...vvv.>>vv>v....v.>>.v.>>.v....>v>....vv..v.v>.vvv>>.vv.vv...v.>>.v.v.>>>.>.>v>.>v.>v....
v.vv>>>vv.....>.......v.v.vv.>.....>v.v....>..v.>>v>.>>..vvv..v>...>v>.>..>..>.vv.vv.v.>>>.vv>...v.>>v.>.>v....vv.v>>.v.vv.>.>.>.>.v.>>.>vv
>v.v.>v.>vvvv>.vv..v....v>.v>.>...>v.>.v.>vv>..>v...v..>vv>>.....>>vvv>..>.>.v>.>v>v>v.>.>...v.>>.>>.>>.>.>>...v...>.>......>....>.v..v.>.>
vvv>.vv....>.>.v....>v..v.>>v..v.v.v..v.v..>..>>v...v.>>v....>>v.>>v...v....v.v......vv..v.v>...v....v..>..vv...v..>.v>.v>.>..v.......>v.>.
.>>>>.v.....>..>vvvv...v..>.v.>v>>....v.....>.v>>.>>>v.....>..>v>...>.>v.v.......v.>...v>>...>v..v..>...vv.v>v.>v.v>.vv.v>vv...v....>vv...v
....v>>...>v>.vv.v....v..>.>.>..>v.vv.>..>...vvv.>vv.>v...v..>..v.....vv...vv.>vv...>.>v>.vv...>>>>v>>..v>.....v.>v...>v>>...>vv...vv.>..>.
>..>vv...>>..vv.>>v...>.>v.v>....v>v..>vvvv>>.>vv>v.vv>.vv.>>vv...>v>v>........vv>.vv>.>..>>>..>.>>v.....vvvv>>v.>>.vv>v>v>....>.>.v.vv>v.v
v......v>..>vv>>.>v..>>..>...vv.....>v>..v.>..v.v....v>vv..>>>..vv.>>>vv.>v.....vv.v>.>.>..>...v>.v..v.>.v>>>>.>v..vv>..vv...v.v>>.v.v.>..v
..>.........>...>.>..vv.v>.>>>.....v.v.v>.>.v....>...vv>v..v..v.v...v.>>vv.v>.>.>..v.>.v..>..v>.v.vv..>.v..v.>>v..v..>.>>.>....>....v>v.v>v
v>.v...v....v.vv....>.>..>>v...v>..vv.vv.v.>vvv.>>>.vv>..v.>>.v>v>.vv>>v>.v>v>>>.>...>v.vv...>v..>....v.....v...>...vvv.>>>>v.v.>..vv.>v>..
.>...>vv.>v>v>vv.v....v>..>...v>>.v.>v..v.v>>v..v>>.v.....vv.v..>>v>.v.v>>>v>.v.vvv>.....>v...v>....v>.v...v>....>.v>v...>v.v.....>>..>.v.>
..v..v...vv.>.v.>>v...v.>v..>.>..>..>v...vv>...>...>.>...v>vv.vvv.v.>.>vvvv.vv.vv..>....>>...>>.vv>.>..>v.v..>.v.>>.>>>>>v...v.>...v.vv>.>.
.>..vvv.vv..>v>v.v.v.v>.>..v>>.v..v>..>...>.vv>v.v>v.>>vvv>>..>.vvv.v..>.v>.>v...v.v.>.>v.>.v....v>.v>.v>v..>vvvv.v.....>..vv>v.>>..>.v.v>>
v>v.vv.>.>>>>>.v..v>.>.>...>>>..>v>>..>.>>..>>vv.>..v>v..v...>.....>v......>v.vv.>>.v>v>>..>.v.vv..vv.>..>....>....v>..v>v.v...>.>.v..v.>..
.......v>>..>.v>.>.>....v..v.>>.>v>>.v>vvv.v.>..>v>v....v..v....vvv.v....v.....>>.v>>vvv.>vv.v>......>v...v..v>.....>vv..vv.>..>v.v.v..v.v.
v.v..v>.>.v..>v>>.v..v>.>..>...vvv...>.vv...>>......>vv.>v.v..v...v..>v>>vv>>..>>>...v>......v.v..v.v.>>v.>v.vv.>>..>....v>v..>>v>>v...>vv>
v..v>v>..v....>..>..vv.>..>..vv.>>.>..>.v...>.>...v...v>>>..>.>v.v.vv.v.>...v..>..>.......v>.vvvv...>..>>.vvv.>..>....v..>>>v.v>>>>.v...>.v
.>.>>>.>..v...vv..>.vv..vvv.>.vv..v>>v.>v>......v.v.v...>v>v>.....>>..>.>>v.v>.>.>vv>....>...v>.>.>>...>v.vvv..>.>>vvv.>>....v>....>>.>...v
v...>>>.v..>>.>>.>>>..v>>>..>..v.>.>v..v>v..vvv>.vv...v.>..>.>>...>>....vv....v...v.>.v>>v..v...v.>..v..>.v>.>....>>.>...vvv.>..>.v.>.vv...
...v>.....>...v...>vvvv..>.>vvv.>.>.>.v....>.v..>>v..>..v..v.>>vv>v.v....v...v.v>v..>..v.v>v.>v..>.v>>vvvv.v..v..>.>>...>>>v>.v.>v>.......v
>v.>vv.....vvv.>.v..>.>.v>.>...vv...v.vv.v..>>>v.vv.>...>>>.>v.>>.v.>.>v>vv.>..v>.v..>v..>.>..>.v>>..v>>>v..v..v>>>.v.>>>v.>.v........vv.v.
..>v>.>>>..vv>..>....>..v.>.>....vvv.>..>>v....>.>...v....>..vv>>>.>>v.vv.v..>>..v.vv.>.>.vv...v.v>..>......>...v>>.>..>v..>....>.....v.>v>
>.v>v>vvv.v.v>v....>v.>v>.v..vv.>..>v.>.>v..v..v.v......>.vv>v.>.......>vv.v>>>>.>..v>v.>v>>.>........v>...v...v>...>v.......v>.>v...v.v>.v
v>>.v..>vvv>.>.v..v..>v..>>..v>>>>>>vv>.v.>>v.v>v>.v..vvv.>.......v....v>.v.>vvv..v.>...v....>v>.v>.v>.>v...>vvv.....vv.>>>.>.>v>v>..v.v.v.
.v...v>>>v.>>vvv...v.v>>..v>vv..v..>v>.v>v..>>.v>.v>>...>..>vv>..vv>v.........v......>.>>v..v.vv>v...>.>.v>v..v...>..v.>>>..>v..>..>...>>.v
v..>>..vvvvvv.v.>>vv>v..>...>..>.v>...>>vvv>v>..>>.>.v.>v.>>.>>..v>.>v.>..v>>.>vv>.>.>vv.>..v>>..v.>>.>v..>>>>vv>>>..>.v.>..v..v.v>>..v>.>>
.....v>v...>vv>.v>>..v>.v..>>>v.>.....v..>.....>>vv.>.v.>vv>.v>..>>.>v>.v>>>v.v.>v.vv>>>..v...v.>.v.>>..>....v>..>.v>..vv..vv....vv.>v>>v..
>....vv.>..>>.>>.......>.vv...>vv......>v.>vvv......v.vvv..>v>..v..v....>........>.v..vv.v..>..v.>v>.v>.>.>.>.v.v.v.vv...v.....>..>>.......
>.vv....v..>v.v.vvvv...>.vvv.vv..>..>v>>.v...>.>.vv.....v>..v...v>.>...v..>.>.>vv.>..vv..>.v....>..>>.>......v.>>vv...v...v..v.v.v.>.v>..v.
v..v>.>>.>>.>>vvv>.>>>vv..>v>>v>v.v..vv....v>>....>v>.>.vv.v.vv>.>>vvv.>>.>>......>...>..vv>v>.>v.v.vv.>>.>.>.vv..v..v.vv.v>.vvv.v>..>...v.
...>>v.v.v.>.>>...>vvv>..v..v.vvv...>.v>.>.>v..>.vv>..vvv>>.....v..>>.......>v......>v.>.v.vv.>...vv.vv....v.v..v..v>>vvv....>v.....>>v.v..
..>..v>>.>v..>......v.>...v.v.v...>.>>vv>>.vv.>>>>>vv>..>vv..>...v.v>.>vvv>....>.>>....v.>>...v..v...vvvv>...v>>>>>vvv>vv......vv.......>.>
.>v.>>.>>..>.>v...v..>.>>..>....vv...>...>v..>..v>v>....>..v>>v.>.>>>.v.v..>.v..>v>.v.v>.v.>...>...>v>..v.>..>>v>.v..>.v.v..>..>.>>vvv>>.>v
v........v>>>.>..>....>.>.>>...>v..v.>v>...vvv>>v>.....vvv..v..v.>..v>.vvv.>.....>.v.>.>>.v..v.v>>>.>>...>.v.>.>vv.>v>.>>......v.vv.>.v..v>
v.>.v>>.>..v......v>v>...>.>>.>v..>>..>....>v.vv..>..v>vv.v.>v....>...>v>..v...>>v.v...>>.v>..>.>.>..>>.v.....v>.>v...v.v.>vv.>.....>v.v>..
v.>v.>v.>>>v>.v>.>>...>.>vv.>v.......vv......>.>>.>..>vv.>....vvv....v>.>>.>.>v>.....v....v...>vvvvvv>.>.....>.v>v.vv.>.v>.>v>v>v>..>....>>
>vv..vv.v...>vv.v.vvv..vvv>..>....v>.vvvv..>.vv.>.vvv.>v>.>.v..>.........v>.v..vv>...>.>.>..vv...>.....v>v>..>.>..>...vv..vv..v>..>.>>>.>>>
.>>..v..>.>.>>v>>.>vvvv.v.v.>>v.>v....>..vv.......v>v..>.>..>>>vvvv>.v.v.v>v....v>..vv.v.v.v>>...v>.........>........v.vvv..vv.....>.v.>>>>
....>.>vv>>>>.......vv...v>>>.>v.v.v.v.v..>v.>..>>>>...>..v.>>.>>...v..>v...v.>v>v>>>v>v>>.>.>>v>..>>..v>.>v.vv...>..v.>v....>v>v.>v.......
>>>v>.>>.>>v.>v..>.v>..v>.v..>.v....v.>.>...>v.v>.....>>v.>..v..>>.>vv.>.vv.vv.>...>..v..vv...>vv.v.....>.....vv>v.>>....v.>.v....>>.>>.v.>
..v>vv>v>>.v..>v.>>...>..>v....v>>.v..v...>...>.vv>.>.....v>>v.....v.>v.v.v>.>.v...>..vvvvv...vv....>...>.........>.v.v..v.v...vv>v.>.v.vv.
..v..v>.v>v..v...v..vvv.vv.>......>.>.........>>...v...>vv>..v..vv>...>.vv..........>>.>>>v>>.>>>.vv....>.>vv>..v.>.>.v.v..>>v>>vv>.v.>....
v..>>.>..>>.v..>>v>..v..v.>.vv>.>vv.>.>.vv.>.>v.v>....v.v...>.>>v....v..>.v>vv...>v>.v...>v.>..vv.>v>>.vv>>>.v....>>v..>.>v>.>.>v>.vv.>.v..
.>v.>>v>>v>v>.>.>v.>.>>..v>.v...v>>.>..>>..v>>>>.>v..>v>.....>..>..>.>>>.vvvv.v.>>....vv>..v>v>.>..>...v.v..>v...v...>...v.>.>.v.v.v..>....
v>.v...vvvv..>v..v>.....>...vv...>v.>.....vv..v>.>....>v..v>.v.>>.v>.>vv.>...vv.......>...v...>.v....v..v..>vv>v.>..vvv...v>vv.v>v.v>..>.vv
v>.vv>.>..>.v>>.....v...v>..>>.>..v...>.>..>v..>>v>.vv.vvv..>...>>..>>>...>..>.>>>v....v.......v>.>>v.vv>.v>v.v>.....>>.v.>....>v>>.>....>v
v...>..vv>v>v.v>..>v.....>.....>..>>.>.....>vvvvv.v...>.v..>vv.v>v.>v....>vvv...>..v.v..v>.vv>>>v>v>.......vv.>..v>>.vv.>...v.vv..>v...>.v.
v..v>vv.>.>>>..>.v.>vvv...>.....v.>....>>..>.vv.v.v.>v..>>vvv.>>>...v.>>v>vv>v..>>..v.......>.>>....>>vv.v..>..v....>v....>.v>.v>.....vv...
.vv.>.>vv.vv....>v.v..>v...>>.>>.>.v....>vvv>.vv...>....>....>v.v>>.v.v.>.>...>....v>>..>.v>....v..>.>>vvv>v>.v.>.>>..v.>..>.v>...>..>vv..v
.>v>>....>vv>...>.vvv.>.>v>...v.>>vv>..v>.v.>vvv.v.>>.....>.>>>v>v>....v...v>v.vv.......vv.>.>.>......>...>>..>.v.vv...>.v>>..v..v....v...>
>>.>....v>...>v...v...v.>>.>v.v>vv>..>.>..>.....v.>>..>>.>>..v..>...v...vvv......v>.vvv.>>.v..vv..>v.v.......>.v...v..>>>>...>>.v..v>.v..vv
v..vv....v>....vvv......>>v..v>>v>...vv.vv>..v.v......v...>.vv....>v..>.v>.>v>v...v>>v..v>v......v>>v>v..v>>vv..v.v.>v.>vvv........>...v...
.v>.>vv.vv>.>>>.>v.>...>.>.>v.....>.v.>v.>.>v..>v.v.>v.>...>v.>v..>..v.v>..>v.v.v>vv>>v.v.>>.vv....>v>...>..v....>v..vvv>vvvv..>.v.>.v>>v>.
.vv.......v.....>.v...v>..vv..>v>.vv>>>..vvvvv>>.vvv.>vv.v.....>>v>.....>....>..>...v>>.>>.v>v.vv..>>>v.v>>....v>v.v..>v..>.>.>.>...v.>>.>.
..>....>>>>>.v.v.>.>>v.>....v.v.....v.>v>>v>.v.vvv...v..v>v.....v.....v..>v.>vv.>.>>v.>...v..>...v.>>>.......v.>v>>v.vv>v...>>...v>vv.v.>v.
>>>..v.v...v..>..v.>.>v...>...v>v>.v.......v.v>>vv.v.vv.v.>.>....v....>v>..>...>v.>.v...v..>>vv>vvvvv>..>v.vv...vv.v.>>.>>v..v.>>>v>v.>>>..
>>vv>v..v.v>.>>v..>v.....>>..>v>...v..>.>vv.>.v.v.vv..vv.v.>.>.....>.>v>v..>>...>vv....vv....v.v>>v..v.>v.v>v>.v..>.>v>>v..v..vv.>v>.....>.
vv..>v..v>...>.>v...v..>..>>v.....v.vv..>.>>>v.vv.>vv...v.>..v>.>...>vv>>vv>>>...v..>v..>..v..>vvvvvvv...v>>..>>>.>.>>>v.>>v.v.>v.vvvv..>.>
>>>.>....v..v..>..>>.>vv.>.....>>>v.v.......v..v.>.>>.>.v...v>>v.>>..vv>..v..>.>...v..>..v.v...>.vv.>v..v>vvv..v>.>>vvv....>v>>vvv.vv.>.v..
v>>.v>>vvv...v.....v...v...>...v..>..v>>>>v..>.v...v>>vv>..vv......>.>>v..vv...>.vv>>>.>>>v.>>>.v...>vv>.>>v>>>v>v.>v..v>>v.>.>.>.>.>>v..>.
....vv.v>>v>.vv.v...>>>....>>.v..v.v.>v>vv.v..v......vv>.>.>.......>vv...>v..vv.>.>....>v.>.....v.v.....v.v>.>..v>...>>v>..v>.v>.....>..>vv
>vvv.v>>>.v........v>...>>.>>v...>v>..>v.>v>.v.>>>v>>>..vv...vvv.v>v.>..>v.v..vv>.vv..>...>.>>>v.v...>....>>.>.>v.vv>v>v.v.v>...v..>.>.v.>.
.>vv..>>v.>v.>>v.>v..>v......v>v>v..v.>>>>>.>.....>..>..>>v...>....v>...vv..v>>.....v..>...vv.v.>>v.vvv...>..>.....>>v.>>...v...vv..>vv>.v.
..>v.>>.>>>vv....>>>v>.>.vv.v.v.vvv..v.vv>>...v.v>.>..>.>..v>v>>....>.......>..v>.>>>..>>>........>>..>>>....v...>.vv>>>>.>...vv....vv..v..
.v....>..v.>>v.>>vvv......>>v>>...>..>.vv>v>...vv.>>.vvv>.>...>.>>>.>..>>.>>v..>..>vvv.>v>>vv.....v..>>..v.>..>..>..v..>.>.>>.vvvv..>.>.v>v
v.v.>>>.vv>>..>.>.>>v>>>.....>..v>>.>.v>>>.v>>>>v.v.v>v>>...>....v...vv>>.>>v.v...vv....v.>.>..>.>..>.v>..v..>.>v.>>>>...v.>.v...>>>....v.v
>.>v...>v>v.v...v.>.>vv>v.>.vv>vv.>>..>v.v>..>..>....v>>>.....>>..>..>.vv.....v.v>.....>.>>v...>v>v..>..>>...v>...>>.>>...>..v...v.v..>vvv.
>v>>v..v.>>v>.>>...>.vv>.>.>v.v...v>....vv..>.v..>>v>..>..>>>>..>.>v...v..>.v.....>>......v.>.v.....>.>>v.v>>.>vvvv.>v.>vv>vv>v>...v..vv>..
.v>..>.v.v...>vv>..>.v..>..>>.vvv...v.>.v.>>v>...>...>.>v>..v.vv..>>.vv.v>>v>...>..v.>>...>...vvv.>.v..v.v>>..vv.v...>...v..vv>>..>.v...v..
v>>>.v.vv...vv>v..v...v.>>v.v..vv......>>..vv.vv>v.vv.>..v>>vv>.>.v.>.vv..v>>v.>.vvv..>>.v>v>.>.v.>..vv.>...vv.vv..vv.>.>.v...vv.>v.v..>.vv
>...v>>v.vv>.>..>.>>>.vv>vv.v.v>....v>v.v.>.>....>v.v>v.>....vv.v.>>vv...>.>>.>..v..v...v>>v..>>.>...v>>>>...>v..........vv>v.>.v.....>..>.
.>>v.>.vvvv>>>..v..v>v....v...>...v.v....>.>...v>.>.>.v>vv>v>>.v..v.>vv>..>>..vv>>.>>v..>>..>..>>v..>v..v......>.>v....>v..v>...vv>v..v..v.
....v..>.>>v..>..>....vv.>.>>v>...>>..vv.>>v...v..>v>.v..v.v.>>.....>v...>>.v>.>>...v>..v..v.v...v>v.>v.>...v..vv>...>>>>..v.>v...vv.vvv.v.
v.v.v...vv.v.>v.>.>...v...>vv....vv.>...>v>>.>v>..>vv.v.>.>.v.>.>v>>>..>vv......>...vv...v>....>>..v>>..v>..>v......v.v>....v..>.>vv.>vv.>.
.>>>..>>.v..>.....>v.>vv.....v.v.>vvv>>v.v....v>....>vv..>.v.v..>.>v>v>>..vv.>...>>.>.>>v>..>.>>..vv>......vv.>>..v>v>..v.v.v>.>..>>v..>.v.
>..>..v.v........v.>.>.>..vvv..>>..>v.v>>>.>.>>>v>>v.>..>v......>.>.v.>..vv...v....v.>...v.vv....>v.v..vv......>.v..>vvv.>v.......>..v>>>>>
..>.>v....v.>..v.>v>..>..>.>>v>.>..>v...v...>.>.v..vvvv..>vvv>..v..>v>...v.>.>.v.v...>>>..>vv.....v.vvv.v.>.v.>.>v>.v.>.v.v..>.>..>>.>..v>.
>>..v>..>..v..>...>..>v>vv>v.v>...v.v>>>...v>.v>.v>....>...>..v.....v>.>.v.>.>>....>>.>>>>..>v>....>...>.>..>..>..>...v..>........vvv...>>.
.v..v.v.>>>.>>>..v..v.v.vv>v.v>........>.>....v.v.v.>.>.v..v.>v.....>v..>.>...>.>...>.v.>vv.>>.>>vv.vv.v>v>...>v.v..vv>vv...>.v>.v>v.>>v...
.>v.v.v.>v.vv.....>..>.>v>vv....v>.v>.v>.>.>.>>>.>...vvv.v.v.v>v.>.vv...>.vv.>.>v.v......v.vvv..>>>.............v.>>......vv>>>.v>..>v>..v.
.>.>>..>>.....>v>v..v..>>...>v..vv...>vv..>v.>....>.>...>..vv>>.>v.v>vv..vvvv.>>.>>v.v>..v>v>>>v>>.>>..>.>..vvvvvv.v.......vv.v.>..>.>.>.v.
>v..>>....v.>....vv.>v>>......>v..>...v>.>.>..>>..>..>>.v.>.v.>>.>.v>v.v>.>>.>.......>v>vv..>.vv.>>vv.>.....>v.v>>.v...v..>...>>v..v.>.>>>.
...v..>.>>v>.....>.>>v....v..v>..v..v>>vvv>.>.v>>>v>......v>..>>v>.>v>.v>..>.v>>..>v>....v...>.>>>>v.vvv>...>...>.v..>v>.v.v>v.vv..v>>.>..>
>.v..v..>.>.v...>>>>..>>...vv......>.>..>..>.>.v...>.>.v>.........v>v...v>..v.>..>v>v.>.vv.v.vv.>.v..>.v.>>......>v..>>.>..v..v.v...>v..v..
.....v.>>...>....v..vvv...>..>..>.v.v..>v.>>v.>>>..vv>.v>vv...>.>...>>.>>.v..v...>vv>.....>>..v....>.v>>>vv>......>>.v.>..>v...>...>vv..vv.
..>..vvv.v.>..>v.>.>.>>.v>>>.>>>.>..v.vv...vv.>..vv>.>..>..>.v..>v..>>..>>v.>>.v.>vvv...v.>.>...>v....>vvvv>v.>v....v..>.>...>..v>.v.>...>>
..>.>v>.....>>>vv>v>..>>..v.>>.v>v..v.v.>v.v.v...>.vv.>.>.....>.vv....>>v.>v..>v.vvv>>.v.v..>....>.v....>...>.>.....>v>....>>.....>>vvvv>>>
.v..>..>>.v.>....v....>.v..v>.v.v.>.>v......>v......v.......>...>>v....v>>.v.v.>>v.v..vvv.>....vv.v........v.>>.v>>.v..v>.>>.vv>..v.v.vvvv.
>.>...v.>v..vvv.>...>....v>v..>v>.v...v>...v..>..>.v>>.>>....>...v.>v>>.v......>...>..v.v>....>.v.v..>v>>..v>>.>vv>..v>.vv>v.>..v....>>v..v
v.v.v.>.....>.>vv..>>.>.v.v.........>..>v.v>>.>..v...>>.>.>v.v>>>vv.v..vv>..>vv......v....vvv>....>v...>>v.>.>...v>.>.>.....>.>.>.v.vv>>.vv
>...>>vvv.....>>.>..vv>v>vvv>........v>v>>v..v..v..>vv.>.v.v.>v....v>.>..v>.>..>vv.v.>.v>..>v.....vv.v.v.....v..>v..>.>.v>>vv....>.>..v>...
.....>v>.v...v....>v.>.vv..>.>v.v>.>v.v>.vv..>.v>..>vv...>..>.>>>>>v>..v>vv>v.v>.vvv.>v..>>.v>v.v>.>.>.v.vv.v>.>>v..v>v.v....vv..v>.>.v.>.>
>.>.>>>.>>...>>vv..v>v..vvv.vv.v.v.v..v...v...v.>.>>v>.>v>.....>.>v...v..v.>....v>>.v>.>>....>v>>v..>..>v>.v...>...>>.>vv..>.v>v..>v..>v..v
.v...v.vvv..vv.>...v>.....vv.>.........v>v..>.>.>>...>>.vv...>...>vv>.vv.>......>>v..>>.>.>v....v.v>>..vv......vv>>>v>.>....>v>v...>v>.>...
.>>..v>vv>.>.vv.>v.vv..v....vvvvv.>>v>vv...>.v>v>v..v..v.v.>.>>vv.....v>...>>v..v....vv..>v..vv..>>>..v..v.>.v....>v>.v.>....vv..v...vv..vv
vv>..v>.>.v>.v>...>>...v>.>.>vv..>.>.v..>v>.>.>>...>....v>v..>v.vv.>..>....>vv.v....vvv>...vv.>.>.>.....v.>.vv........v...v..v....>v>>...v.
"""

func parseInput(input: String) -> [[Point]] {
    input
        .split(separator: "\n")
        .enumerated()
        .map { y, row in
            row
                .map { String($0) }
                .enumerated()
                .map { x, value in
                    Point(x: x, y: y, val: value == ">" ? 1 : value == "v" ? 2 : 0)
                }
        }
}

class Point: CustomStringConvertible {
    var x: Int
    var y: Int
    var val: Int // 1 = east // 2 south

    init(x: Int, y: Int, val: Int = 0) {
        self.x = x
        self.y = y
        self.val = val
    }

    var east: Bool {
        val == 1
    }

    var south: Bool {
        val == 2
    }

    var description: String {
        val == 1 ? ">" : val == 2 ? "v" : "."
    }
}

typealias Grid = [[Point]]

extension Grid {
    subscript (x: Int, y: Int) -> Point {
//        print(x, y, x % indices.count, y % indices.count)
        let row = self[y % indices.count]
        return row[x % row.indices.count]
    }

    func movingEast() -> [Point] {
        map { row in
            row.compactMap {
                $0.east && self[$0.x + 1, $0.y].val == 0 ? $0 : nil
            }
        }
        .reduce([], +)
    }

    func movingSouth() -> [Point] {
        map { row in
            row.compactMap {
                $0.south && self[$0.x, $0.y + 1].val == 0 ? $0 : nil
            }
        }
        .reduce([], +)
    }

    mutating func moveEast(point: Point) {
        self[point.x + 1, point.y].val = 1
        self[point.x, point.y].val = 0
    }

    mutating func moveSouth(point: Point) {
        self[point.x, point.y + 1].val = 2
        self[point.x, point.y].val = 0
    }

    var description: String {
        map { $0.map(\.description).joined(separator: "")}
            .joined(separator: "\n") + "\n"
    }
}

var points = parseInput(input: input)

var step = 0
while true {
    print(points.description)

    let eastMoving = points.movingEast()
    eastMoving.forEach { point in
        points.moveEast(point: point)
    }

    let southMoving = points.movingSouth()
    southMoving.forEach { point in
        points.moveSouth(point: point)
    }

    step += 1

    if eastMoving.isEmpty && southMoving.isEmpty {
        break
    }

    print(points.description)
}

print(points.description)
print(step)
